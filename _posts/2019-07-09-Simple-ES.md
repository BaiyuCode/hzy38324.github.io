---
layout:     post                    # 使用的布局（不需要改）
title:    为什么需要 Elasticsearch    # 标题 
subtitle:   #副标题
date:       2019-07-09              # 时间
author:     ZY                      # 作者
header-img: img/banner/20190128/miguel-angel-hernandez-1322895-unsplash.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - Elasticsearch
    - 中间件
    - 搜索引擎
    - 大数据
---

# Elasticsearch是什么？  

> Elasticsearch is the distributed search and analytics engine at the heart of the Elastic Stack. 

一个分布式的搜索与数据分析引擎。  

# 为什么需要 Elasticsearch？  

用数据库，也可以实现搜索的功能，为什么还需要搜索引擎呢？  

就像 [Stackoverflow](https://stackoverflow.com/questions/51639166/elasticsearch-vs-relational-database) 的网友说的：  

> A relational database can store data and also index it.  
> A search engine can index data but also store it.  

数据库（理论上来讲，ES也是数据库，这里的数据库，指的是关系型数据库），首先是存储，搜索只是顺便提供的功能，  

而搜索引擎，首先是搜索，但是不把数据存下来就搜不了，所以只好存一存。  

术业有专攻，专攻搜索的搜索引擎，自然会提供更强大的搜索能力。  

1、更强大的搜索能力：和相关性匹配   

在使用数据库搜索时，我们更多的是基于「精确匹配」的搜索。  

什么是「精确匹配」？  

比如搜订单，根据订单状态，准确搜索，搜「已完成」，就要「精确匹配」「已完成」的订单，搜「待支付」，就要「精确匹配」「待支付」的订单。  

这种「精确匹配」的搜索能力，传统关系型数据库是非常胜任的。  

和「精确匹配」相比，「相关性匹配」更贴近人的思维方式。  

比如我要搜一门讲过「莎士比亚」的课程，我需要在课程的文稿里进行「相关性匹配」，找到对应的文稿，

你可能觉得一条sql语句就可以解决这个问题：  
```sql
select * from course where content like "%莎士比亚%"
```

然而，这只能算是「模糊查询」，用你要搜索的字符串，去「精确」的「模糊查询」，其实还是「精确匹配」，机械思维。

那么到底什么是「相关性匹配」，什么才是「人的思维」呢？  

比如我搜「莎士比亚」，我要的肯定不只是精精确确包含「莎士比亚」的文稿，我可能还要搜「莎翁」、「Shakespeare」、「哈姆雷特」、「罗密欧和朱丽叶」、「威尼斯的商人」…  

比如我输错了，输成「莎士笔亚」，「相关性匹配」可以智能的帮我优化为「莎士比亚」，返回对应的搜索结果。

这就是搜索引擎的强大之处，它似乎可以理解你的真实意图。  

  

文档型存储

传统的关系型数据库，1、把形象的数据，拍平了存储、2、B+树索引 这几点都不利于全文搜索  
> 也许有一天你想把这些对象存储在数据库中。使用关系型数据库的行和列存储，这相当于是把一个表现力丰富的对象挤压到一个非常大的电子表格中：你必须将这个对象扁平化来适应表结构--通常一个字段>对应一列--而且又不得不在每次查询时重新构造对象。

文档存储、倒排索引对全文搜索十分友好  

使用场景：日志搜索和分析，error、warn、根据时间过滤，根据内容模糊查询

2、搜索分析，不只是搜索，还有分析  
> 原始数据如果只是躺在磁盘里面根本就毫无用处。  —— 《权威指南》

躺在磁盘里的数据是没有价值的。   

Elasticsearch 真正强大之处在于可以从无规律的数据中找出有意义的信息——从“大数据”到“大信息”。  

和mysql一样，es提供了一些简单的聚合操作 https://www.elastic.co/guide/en/elasticsearch/reference/6.6/sql-functions-aggs.html  

当然，实际的业务场景，很多是无法通过这些聚合操作就计算出想要的数据的，复杂的处理逻辑，就需要写业务代码、脚本来实现了

目前很多实时计算，都是数据产生后，通过消息队列（比如kafka）推给实时计算平台 storm，计算后，把数据存起来，如果你不需要数据十分安全，可以只放到es，当然，如果你需要安全的数据，则必须同时往数据库放一放。  

当需要数据时，es可以给你提供快速的搜索能力。  

貌似es在这里没有提供什么分析能力，然而只要数据存在于es，这些数据的被探索力就用于比放在数据库里的强。  

主动挖掘数据  
显而易见的东西是没什么价值的，深挖到无人地带，才能带来价值。
>令我最为震惊的是，他们竟然不看表面数据，而是从无限数据的机会中寻找核心数据。
>
>> 这正体现了大数据与传统数据之间最大的不同。以前，我们是“有问题找数据”，而在大数据时代，其最核心的特质则是“用数据找机会”  

这一切的分析数据的功能，都是建立在快速的查询上的，如果没有快速的查询，分析能力无从谈起

# Elasticsearch的分布式架构
插入数据、分片、查询

https://www.elastic.co/guide/cn/elasticsearch/guide/current/distributed-cluster.html

# 深度分页

# next
倒排索引

# 参考

- 《权威指南》
- 《决战大数据》车品觉














